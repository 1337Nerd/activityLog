define(["require","dialogHelper","loading","apphost","layoutManager","connectionManager","appRouter","globalize","userSettings","emby-checkbox","emby-input","paper-icon-button-light","emby-select","material-icons","css!./../formdialog","emby-button","emby-linkbutton","flexStyles"],function(require,dialogHelper,loading,appHost,layoutManager,connectionManager,appRouter,globalize,userSettings){"use strict";function onSubmit(e){return e.preventDefault(),!1}function initEditor(context,settings){context.querySelector("form").addEventListener("submit",onSubmit);var i,length,elems=context.querySelectorAll(".simpleFilter");for(i=0,length=elems.length;i<length;i++)"INPUT"===elems[i].tagName?elems[i].checked=settings[elems[i].getAttribute("data-settingname")]||!1:elems[i].querySelector("input").checked=settings[elems[i].getAttribute("data-settingname")]||!1;var videoTypes=settings.VideoTypes?settings.VideoTypes.split(","):[];for(elems=context.querySelectorAll(".chkVideoTypeFilter"),i=0,length=elems.length;i<length;i++)elems[i].checked=videoTypes.indexOf(elems[i].getAttribute("data-filter"))!==-1;var seriesStatuses=settings.SeriesStatus?settings.SeriesStatus.split(","):[];for(elems=context.querySelectorAll(".chkSeriesStatus"),i=0,length=elems.length;i<length;i++)elems[i].checked=seriesStatuses.indexOf(elems[i].getAttribute("data-filter"))!==-1}function saveValues(context,settings,settingsKey){var i,length,elems=context.querySelectorAll(".simpleFilter");for(i=0,length=elems.length;i<length;i++)"INPUT"===elems[i].tagName?setBasicFilter(context,settingsKey+"-filter-"+elems[i].getAttribute("data-settingname"),elems[i]):setBasicFilter(context,settingsKey+"-filter-"+elems[i].getAttribute("data-settingname"),elems[i].querySelector("input"));var videoTypes=[];for(elems=context.querySelectorAll(".chkVideoTypeFilter"),i=0,length=elems.length;i<length;i++)elems[i].checked&&videoTypes.push(elems[i].getAttribute("data-filter"));userSettings.setFilter(settingsKey+"-filter-VideoTypes",videoTypes.join(","));var seriesStatuses=[];for(elems=context.querySelectorAll(".chkSeriesStatus"),i=0,length=elems.length;i<length;i++)elems[i].checked&&seriesStatuses.push(elems[i].getAttribute("data-filter"));userSettings.setFilter(settingsKey+"-filter-SeriesStatus",seriesStatuses.join(","))}function setBasicFilter(context,key,elem){var value=elem.checked;value=value?value:null,userSettings.setFilter(key,value)}function centerFocus(elem,horiz,on){require(["scrollHelper"],function(scrollHelper){var fn=on?"on":"off";scrollHelper.centerFocus[fn](elem,horiz)})}function FilterMenu(){}return FilterMenu.prototype.show=function(options){return new Promise(function(resolve,reject){require(["text!./filtermenu.template.html"],function(template){var dialogOptions={removeOnClose:!0,scrollY:!1};dialogOptions.size="fullscreen-border";var dlg=dialogHelper.createDialog(dialogOptions);dlg.classList.add("formDialog");var html="";html+='<div class="formDialogHeader">',html+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1"><i class="md-icon">&#xE5C4;</i></button>',html+='<h3 class="formDialogHeaderTitle">${Filters}</h3>',html+="</div>",html+=template,dlg.innerHTML=globalize.translateDocument(html,"sharedcomponents");for(var settingElements=dlg.querySelectorAll(".viewSetting"),i=0,length=settingElements.length;i<length;i++)options.visibleSettings.indexOf(settingElements[i].getAttribute("data-settingname"))===-1?settingElements[i].classList.add("hide"):settingElements[i].classList.remove("hide");initEditor(dlg,options.settings),dlg.querySelector(".btnCancel").addEventListener("click",function(){dialogHelper.close(dlg)}),layoutManager.tv&&centerFocus(dlg.querySelector(".formDialogContent"),!1,!0);var submitted;dlg.querySelector("form").addEventListener("change",function(){submitted=!0},!0),dialogHelper.open(dlg).then(function(){return layoutManager.tv&&centerFocus(dlg.querySelector(".formDialogContent"),!1,!1),submitted?(saveValues(dlg,options.settings,options.settingsKey),void resolve()):void reject()})})})},FilterMenu});